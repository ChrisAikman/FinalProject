<HTML>

<HEAD>
	<meta charset="utf-8">

	<script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="js/d3.min.js"></script>
	<script type="text/javascript" src="js/datafunctions.js"></script>
	
	<link type="text/css" href="css/style.css" rel="stylesheet" />
	
	<!-- Datasets -->
	<script type="text/javascript" src="datasets/births.json"></script>
	<script type="text/javascript" src="datasets/populations.json"></script>
	<script type="text/javascript" src="datasets/deaths.json"></script>
	<script type="text/javascript" src="datasets/deathrates.json"></script>
	<script type="text/javascript" src="datasets/ltboth.json"></script>
	<script type="text/javascript" src="datasets/ltfemale.json"></script>
	<script type="text/javascript" src="datasets/ltmale.json"></script>
</HEAD>

<BODY>
<div id="root" style="margin: auto; width: 100%;" align="center">
	<div id="title">
		<h1 style="font-family: Century Gothic, sans-serif;">EFFECTS OF HISTORIC EVENTS ON LIFE AND MORTALITY</h1>
		<h2 style="font-family: Century Gothic, sans-serif;">Based on Data from <a href="http://mortality.org">The Human Mortality Database</a></h2>
	</div>
	<!--<div style="font-size: 30px; font-family: Century Gothic, sans-serif;">Convert Charts to: <a href="javascript:drawCharts('line')" id="linejs">Line</a> | <a href="javascript:drawCharts('column')" id="coljs">Column</a> | <a href="javascript:drawCharts('area')" id="areajs">Area</a></div><BR>-->
	<div id="controlpanel" style="float:left; width: 200px;">
		<div id="countrypanel" class="controlpanel">
			Selected Countries:
			<div id="countrylist" class="controlpanelinset" >
			</div>
		</div>
		<div id="yearpanel" class="controlpanel">
			HI
		</div>
		<div id="agepanel" class="controlpanel">
			HI
		</div>
		<div id="eventpanel" class="controlpanel">
			HI
		</div>
	</div>
	<div id="center-root" style="float:left;">
		<div id="vis"></div>
		<div id="overview"></div>
	</div>
	<div style="clear: both;" ></div>
</div>
<div id="hoverquery" style="position: absolute; display: none;">
		<img width="20px" id="hqimg" src="#" /><strong id="countryname">Country</strong>
		<div style="padding-top: 2px;">
			<div id="year" style="float: left; padding-left: 5px; font-size: 1.8em;">
				YEAR
			</div>
			<div id="data" style="float: left; padding-left: 5px; text-align: left;">
				Data
			</div>
			<div style="clear: both;"></div>
		</div>
		<img class="callout" src="css/images/tooltippoint.png" />
</div>

<script type="text/javascript">
window.onresize = function( event ) {
	$("#vis").html( "" );
	$("#overview").html( "" );
	generateVis();
	fillVis();
}

var leftOffset = 70;
var topOffset = 10;
var graph;
var overview;
var curdata;

function generateVis()
{
	// Set the dimensions of the canvas / graph
	var visheight = $( document ).height() - $( "#title" ).height();
	var viswidth = $( window ).width() - 200;
	
	var margin = {top: topOffset, right: 30, bottom: 30, left: leftOffset},
		width = viswidth - margin.left - margin.right,
		height = visheight * .8 - margin.top - margin.bottom,
		height2 = visheight * .2 - margin.top - margin.bottom;
		
	graph = addGraph( "#vis", margin, width, height, [0, width], [height, 0], [1800,2020], [0, 2400000], 20, 20 );
	overview = addGraph( "#overview", margin, width, height2, [0,width], [height2, 0], [1800,2020], [0, 2400000], 20, 0 );
	addClip( graph, width, height );
	
	var brush = d3.svg.brush()
		.x( overview["x"] )
		.on( "brush", brushed );
	
	// Add the linking and brushing mechanism.
	overview["svg"].append("g")
      .attr("class", "x brush")
      .call(brush)
    .selectAll( "rect" )
      .attr( "y", -6 )
      .attr( "height", height2 + 7 );
		
	function brushed()
	{
		graph["x"].domain( brush.empty() ? overview["x"].domain() : brush.extent() );
		for( c in data["data"] ) {
			graph["svg"].select( "." + c + data["name"] ).attr( "d", graph["valuearea"]( data["data"][c], graph["x"] ) );
			graph["svg"].select( "." + c + data2["name"] ).attr( "d", graph["valuearea"]( data2["data"][c], graph["x"] ) );
		}
		graph["svg"].select( ".event" ).attr( "d", graph["valuearea"]( [ [ 1870, 0, 2400000 ], [ 1871, 0, 2400000 ] ], graph["x"] ) )
		graph["svg"].select( ".x.axis" ).call( graph["xAxis"] );
	}
}

function fillVis()
{
	graph["svg"].selectAll("path").remove();
	overview["svg"].selectAll("path").remove();

	var selectedCountries = $('#countrylist input:checkbox:checked').map(function() {
		return this.value;
	}).get();

	// Gather the data.
	var json = genBirths( selectedCountries, [ 1800, 2020 ], GENDER_MALE );
	var json2 = genBirths( selectedCountries, [ 1800, 2020 ], GENDER_FEMALE );
	
	var json3 = genPopDeath( selectedCountries, [ 1800, 2020 ], GENDER_MALE, deaths );
	var json4 = genPopDeath( selectedCountries, [ 1800, 2020 ], GENDER_FEMALE, deaths );
	
	var data = {};
	data["data"] = {};
	data["name"] = "births";
	data["type"] = "BB";
	data["draw"] = "valuearea";
	for( var c in json["data"] )
		data["data"][c] = areaCombine( json["data"][c], json2["data"][c], 0, 1 );
		
	var data2 = {};
	data2["data"] = {};
	data2["name"] = "deaths";
	data2["type"] = "DB";
	data2["draw"] = "valuearea";
	for( var c in json3["data"] )
		data2["data"][c] = areaCombine( json3["data"][c], json4["data"][c], 0, 1 );
		
	json = json2 = json3 = json4 = 0;
	
	var 
	
	curdata = [];
	curdata.push( data );
	curdata.push( data2 );
	//curdata.push( 

	// Add the data
	graph["svg"].append("path")
		.attr( "class", "event" )
		.style( "fill", "gray" )
		.attr( "d", graph["valuearea"]( [ [ 1870, 0, 2400000 ], [ 1871, 0, 2400000 ] ], graph["x"] ) )
		.attr( "clip-path", "url(#clip)" );
		
	addData( data, graph, overview );
	addData( data2, graph, overview );
}

function fillControls()
{
	for( var c in births ) {
		$( "#countrylist" ).append( "<div id=\"countryselectdiv_" + c + "\" class=\"controlpanelcountry\" onmouseover=\"baseOnMouseOver( '" + c + "' );\" onmouseout=\"onMouseOut( '" + c + "' );\"></div>" );
		$( "#countryselectdiv_" + c ).append( "<input type=\"checkbox\" id=\"countryselect_" + c + "\" name=\"countryselect\" value=\"" + c + "\" checked />" );
		
		var cw = $( "#countryselect_" + c ).width();
		
		$( "#countryselectdiv_" + c ).append( "<label id=\"countrylabel_" + c + "\" for=\"countryselect_" + c + "\"><img id=\"countryimage_" + c + "\" height=\"" + cw + "px\" src=\"css/images/flag_" + c + ".png\" />" + countries[c] + "</label>" );
		$( "#countryselectdiv_" + c ).append( "<div id=\"countrycolor_" + c + "\" class=\"countrycolor\" style=\"float: right; width:" + cw + "px; height:" + cw + "px; background-color: " + Colors[c] + "; color: " + Colors[c] + ";\">x</div>" );
		$( "#countryselectdiv_" + c ).append( "<div style=\"clear: both;\"></div>" );
	}
	
	$('#countrylist input:checkbox').change (
		function(){
			fillVis();
		} );
}

$(function () {
	generateVis();
	fillControls();
	fillVis();
});
</script>

</BODY>

</HTML>